{% extends 'base.html' %}

{% block head %}


{% endblock %}

{% block body %}
<h1>Test</h1>
<div id="display-box">
</div>
<div id="response-box" class="hidden">
    <form action="/" method="POST">
        <input type="text" name="response" id="number-sequence" placeholder="What was the response?">
        <button type="button" id="response-button">Confirm</button>
    </form>
    <form action="/finish" method="POST" id="response-form">
    </form>
</div>
<button type="button" id="return-button">
    <a href="/">Return</a>
</button>
<script>

    async function sendData(digitSpan) {
        const response = await fetch("/finish", {
            method: "POST",
            headers: {"Content-Type": "application/json" },
            body: JSON.stringify({dspan: digitSpan})
        });

        const data = await response.json();
        console.log(data);
    };


    const numbers = {{ num_list | tojson }};
    const numSequence = {{ num_sequence | tojson }}
    const displayBox = document.getElementById("display-box");
    const responseBox = document.getElementById("response-box");
    const responseForm = document.getElementById("response-form");
    displayBox.classList.add("num-content");
    
    window.dSpan = numbers.length + 1;
    
    let i = 0;

    function showNextNumber() {

        if (i < numbers.length) {;
            displayBox.textContent = numbers[i];
            i++;
            setTimeout(showNextNumber, 1000);
        } else {
           displayBox.classList.add("hidden");
           responseBox.classList.add("present");
        }
    };
    showNextNumber();
    //responseBox.classList.remove("hidden");

    document.getElementById("response-button").addEventListener("click", function(event) {
        const userResponse = document.getElementById("number-sequence").value;
        if (userResponse == numSequence) {

            console.log("This is the correct answer!", numbers.length + 1)

            const advanceButton = document.createElement('button');
            advanceButton.setAttribute("name", "continue");
            advanceButton.setAttribute("type", "button");
            advanceButton.setAttribute("id", "advance-button");
            advanceButton.textContent = `Try ${numbers.length + 1} numbers next?`; 

            const retryButton = document.createElement("button");
            retryButton.setAttribute("name", "retry");
            retryButton.setAttribute("type", "submit");
            retryButton.textContent = "Retry?";

            responseBox.appendChild(advanceButton);
            responseBox.appendChild(retryButton);


        } else {
            console.log("This is the incorrect answer!", numSequence, userResponse);
        }
    });
    
    document.addEventListener("click", function(event) {
        sendData(window.dSpan);
    });


</script>
{% endblock %}