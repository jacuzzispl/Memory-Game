{% extends 'base.html' %}

{% block head %}


{% endblock %}

{% block body %}
<h1>Test</h1>
<div id="displayBox">
</div>
<div id="responseBox" class="hidden">
    <form action="/" method="POST">
        <input type="text" name="response" id="userResponse" placeholder="What was the response?">
        <button type="button" id="responseButton">Confirm</button>
    </form>
    <form action="/finish" method="POST" id="response-form">
    </form>
</div>
<button type="button" id="returnButton">
    <a href="/">Return</a>
</button>
<script>
 
 /* numSequence is the string, numbers is the string*/
    var numberString = {{ num_sequence | tojson }};
    var numberList = {{ num_list | tojson }};
    var displayBox = document.getElementById("displayBox");
    var responseBox = document.getElementById("responseBox");
    var responseButton = document.getElementById("responseButton");
    var continueGame = false;
    window.dspan = numberString.length + 1;

    async function sendData(dspan) {
        const response = await fetch("/finish", {
            method: "POST",
            headers: {"Content-Type": "application/json" },
            body: JSON.stringify({ dspan: dspan })
        });

        const data = await response.json();
        numberList = data["num_list"];
        numberString = data["num_sequence"];
        console.log(numberString, numberList)
    }

    function showOptions() {
        responseButton.addEventListener("click", function(){
        var userResponse = String(document.getElementById("userResponse").value)
        if (userResponse == numberString) {
            continueGame = true;
            advanceButton = document.createElement("button");
            advanceButton.setAttribute("name", "continue");
            advanceButton.setAttribute("type", "button");
            advanceButton.setAttribute("id", "advanceButton");
            advanceButton.textContent = `Try ${numberString.length + 1} numbers next?`;

            retryButton = document.createElement("button");
            retryButton.setAttribute("name", "retry");
            retryButton.setAttribute("type", "button");
            retryButton.setAttribute("id", "retryButton")
            retryButton.textContent = "Retry?";

            responseBox.appendChild(retryButton);
            responseBox.appendChild(advanceButton);
        
        }
        responseBox.addEventListener("click", function(event){
            if (event.target.id == "advanceButton") {
                sendData(window.dspan);
            } if (event.target.id == "retryButton") {
                continueGame = False
            }
        })
    })
    }


    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function showNextNumber(string, list) {
        let i = 0;
        while (i < numberString.length) {
            console.log(numberList[i], i);
            var text = numberList[i]
            displayBox.textContent = text;
            await sleep(1000);
            i++;
        } 
        displayBox.classList.add("hidden");
        responseBox.classList.add("present");
    };
    
    
        showNextNumber(numberString, numberList);
        showOptions();
        
    

    
    </script>
{% endblock %}