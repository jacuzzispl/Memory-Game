<script>
 
 /* numSequence is the string, numbers is the string*/
    var numberString = {{ num_sequence | tojson }};
    var numberList = {{ num_list | tojson }};
    var displayBox = document.getElementById("displayBox");
    var responseBox = document.getElementById("responseBox");
    var responseButton = document.getElementById("responseButton");
    var continueGame = false;
    dspan = numberString.length

    async function sendData(dspan) {
        console.log(`This was dspan before: ${dspan}`)
        const response = await fetch("/finish", {
            method: "POST",
            headers: {"Content-Type": "application/json" },
            body: JSON.stringify({ dspan: dspan })
        });

        const data = await response.json();
        numberList = data["num_list"];
        numberString = data["num_sequence"];
        dspan = data["dspan"];
        responseBox.classList.remove("present");
        displayBox.classList.remove("hidden");
        console.log("sendData is calling showNextNumber")
        showNextNumber(numberString, numberList);
    }

    function showOptions() {
        console.log("Show options is triggered")
        responseButton.addEventListener("click", function(){
        var userResponse = String(document.getElementById("userResponse").value)
        if (userResponse == numberString) {
            /*
            continueGame = true;
            advanceButton = document.createElement("button");
            advanceButton.setAttribute("name", "continue");
            advanceButton.setAttribute("type", "button");
            advanceButton.setAttribute("id", "advanceButton"); */
            advanceButton.textContent = `Try ${numberString.length + 1} numbers next?`;

            /*retryButton = document.createElement("button");
            retryButton.setAttribute("name", "retry");
            retryButton.setAttribute("type", "button");
            retryButton.setAttribute("id", "retryButton")
            retryButton.textContent = "Retry?";

            responseBox.appendChild(retryButton);
            responseBox.appendChild(advanceButton); */
        
        }
        document.getElementById("responseBox").addEventListener("click", () => {
            console.log("Truth condition not met yet")
            if (event.target.id == "advanceButton") {
                console.log("This responseBox event listener was triggered.")
                sendData(window.dspan);

            } if (event.target.id == "retryButton") {
                continueGame = False
            }
        })
    })
    }


    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function showNextNumber(string, list) {
        responseBox.classList.add("hiddden")
        let i = 0;
        while (i < numberList.length) {
            console.log(numberList[i], i);
            var text = numberList[i]
            displayBox.textContent = text;
            await sleep(1000);
            i++;
        } 
        displayBox.classList.add("hidden");
        responseBox.classList.add("present");
        dspan++
        console.log("showNextNumber is calling showOptions this many times.")
        showOptions()
    };
    
    
        showNextNumber(numberString, numberList);

        


    
    </script>